---
title: File Uploads
description: 'Complete guide to uploading files for document fields using presigned URLs'
---

# File Uploads

Learn how to securely upload PDF files to sajn using presigned URLs for use in document fields.

## Overview

sajn uses a secure two-step upload process:

1. **Get presigned URL** - Request a secure upload URL from the API
2. **Upload directly to S3** - Upload your file directly to cloud storage
3. **Use the S3 key** - Reference the uploaded file in document fields

This approach provides several benefits:
- **Security**: Files are organized by your organization ID
- **Performance**: Direct uploads to S3 bypass our servers
- **Reliability**: Leverages AWS S3's robust infrastructure

## Getting a Presigned Upload URL

Request a presigned URL from the [Upload Presigned URL endpoint](/api-reference/POST%20/api/v1/documents/upload/presigned-url):

### Request

```bash
curl -X POST https://app.sajn.se/api/v1/documents/upload/presigned-url \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "fileName": "contract.pdf"
  }'
```

### Response

```json
{
  "url": "https://s3.amazonaws.com/sajn/d/org_123/abc123def/contract.pdf?X-Amz-Algorithm=...",
  "key": "d/org_123/abc123def/contract.pdf",
  "cloudFrontUrl": "https://cdn.sajn.se/d/org_123/abc123def/contract.pdf"
}
```

### Response Fields

- **`url`** - Presigned S3 URL for uploading (expires in 1 hour)
- **`key`** - S3 key to reference in document fields
- **`cloudFrontUrl`** - CDN URL for accessing the file after upload

## Uploading the File

Use the presigned URL to upload your PDF file directly to S3:

```bash
curl -X PUT "https://s3.amazonaws.com/sajn/d/org_123/abc123def/contract.pdf?X-Amz-Algorithm=..." \
  -H "Content-Type: application/pdf" \
  --data-binary @contract.pdf
```

### Important Notes

- Use **PUT** method (not POST)
- Set **Content-Type** to `application/pdf`
- Upload the raw file content (binary data)
- The presigned URL expires in **1 hour**

## Using Uploaded Files in Documents

After successful upload, use the S3 key in document field metadata. You can either create a new PDF field or update an existing one:

### Create New PDF Field

Use the [Create Document Field](/api-reference/POST%20/api/v1/documents/{id}/fields) endpoint to add the uploaded PDF:

```bash
curl -X POST https://app.sajn.se/api/v1/documents/doc_123/fields \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "PDF",
    "position": 0,
    "fieldMeta": {
      "type": "PDF",
      "value": "d/org_123/abc123def/contract.pdf",
      "numPages": -1
    }
  }'
```

### Update Existing PDF Field

Use the [Update Document Field](/api-reference/PATCH%20/api/v1/documents/{id}/fields/{fieldId}) endpoint to replace an existing PDF:

```bash
curl -X PATCH https://app.sajn.se/api/v1/documents/doc_123/fields/field_456 \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "fieldMeta": {
      "type": "PDF",
      "value": "d/org_123/abc123def/contract.pdf",
      "numPages": -1
    }
  }'
```

## Complete Upload Workflow

Here's a complete example of uploading a file and adding it to a document:

### Step 1: Get Presigned URL

```javascript
const getPresignedUrl = async (fileName) => {
  const response = await fetch('https://app.sajn.se/api/v1/documents/upload/presigned-url', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer YOUR_API_KEY',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ fileName })
  });
  
  return await response.json();
};
```

### Step 2: Upload File

```javascript
const uploadFile = async (presignedUrl, file) => {
  const response = await fetch(presignedUrl, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/pdf'
    },
    body: file
  });
  
  if (!response.ok) {
    throw new Error(`Upload failed: ${response.statusText}`);
  }
};
```

### Step 3: Add to Document

```javascript
const addFileToDocument = async (documentId, s3Key) => {
  const response = await fetch(`https://app.sajn.se/api/v1/documents/${documentId}/fields`, {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer YOUR_API_KEY',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      type: 'PDF',
      position: 0,
      fieldMeta: {
        type: 'PDF',
        value: s3Key,
        numPages: -1
      }
    })
  });
  
  return await response.json();
};
```

### Complete Function

```javascript
const uploadAndAddToDocument = async (documentId, file) => {
  try {
    // Step 1: Get presigned URL
    const { url, key } = await getPresignedUrl(file.name);
    
    // Step 2: Upload file
    await uploadFile(url, file);
    
    // Step 3: Add to document
    const field = await addFileToDocument(documentId, key);
    
    console.log('File uploaded and added to document:', field);
    return field;
  } catch (error) {
    console.error('Upload failed:', error);
    throw error;
  }
};
```

## File Requirements

### Supported Formats

- **PDF files only** - Filename must end with `.pdf`
- **Maximum size**: 50MB per file
- **Content-Type**: Must be `application/pdf`

### Security

- Files are automatically organized by **organization ID**
- Each upload gets a **unique folder ID** for isolation
- Presigned URLs **expire after 1 hour**
- Only authenticated API users can generate upload URLs

## Path Structure

Uploaded files follow this path structure:

```
d/{organizationId}/{uniqueFolderId}/{filename}.pdf
```

Example:
```
d/org_abc123/def456ghi/employment-contract.pdf
```

- **`d/`** - Documents prefix
- **`organizationId`** - Your organization identifier
- **`uniqueFolderId`** - Random 32-character identifier
- **`filename.pdf`** - Slugified version of your filename

## Error Handling

### Common Errors

#### Invalid File Type
```json
{
  "message": "Endast PDF-filer är tillåtna"
}
```
**Solution**: Ensure filename ends with `.pdf`

#### Expired Presigned URL
```bash
HTTP 403 Forbidden
```
**Solution**: Request a new presigned URL (they expire after 1 hour)

#### File Too Large
```bash
HTTP 400 Bad Request
```
**Solution**: Ensure file is under 50MB limit

#### Missing Authentication
```json
{
  "message": "API token was not provided"
}
```
**Solution**: Include valid `Authorization: Bearer` header

### Best Practices

1. **Check file size** before requesting presigned URL
2. **Validate file type** on client-side first
3. **Handle upload errors** gracefully with retries
4. **Store S3 keys securely** for later reference
5. **Use unique filenames** to avoid conflicts

## Integration Examples

### React/Next.js

```tsx
import { useState } from 'react';

const FileUploader = ({ documentId, onUploadComplete }) => {
  const [uploading, setUploading] = useState(false);
  
  const handleFileUpload = async (file) => {
    if (!file.name.toLowerCase().endsWith('.pdf')) {
      alert('Only PDF files are allowed');
      return;
    }
    
    setUploading(true);
    
    try {
      // Get presigned URL
      const presignedResponse = await fetch('/api/documents/upload/presigned-url', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fileName: file.name })
      });
      
      const { url, key } = await presignedResponse.json();
      
      // Upload file
      await fetch(url, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/pdf' },
        body: file
      });
      
      // Add to document
      await fetch(`/api/documents/${documentId}/fields`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'PDF',
          position: 0,
          fieldMeta: {
            type: 'PDF',
            value: key,
            numPages: -1
          }
        })
      });
      
      onUploadComplete(key);
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
    }
  };
  
  return (
    <input
      type="file"
      accept=".pdf"
      onChange={(e) => handleFileUpload(e.target.files[0])}
      disabled={uploading}
    />
  );
};
```

### Node.js

```javascript
const fs = require('fs');
const fetch = require('node-fetch');

const uploadPdfToDocument = async (documentId, filePath, apiKey) => {
  const fileName = path.basename(filePath);
  const fileContent = fs.readFileSync(filePath);
  
  // Get presigned URL
  const presignedResponse = await fetch('https://app.sajn.se/api/v1/documents/upload/presigned-url', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ fileName })
  });
  
  const { url, key } = await presignedResponse.json();
  
  // Upload file
  await fetch(url, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/pdf' },
    body: fileContent
  });
  
  // Add to document
  const fieldResponse = await fetch(`https://app.sajn.se/api/v1/documents/${documentId}/fields`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      type: 'PDF',
      position: 0,
      fieldMeta: {
        type: 'PDF',
        value: key,
        numPages: -1
      }
    })
  });
  
  return await fieldResponse.json();
};
```

## Related Resources

### Guides
- [Creating Documents](/guides/create-document) - Learn how to create and configure documents
- [Send for Signing](/guides/send-for-signing) - Send your document for signatures
- [Webhooks](/guides/webhooks) - Get notified when documents are signed

### API Reference
- [Upload Presigned URL](/api-reference/POST%20/api/v1/documents/upload/presigned-url) - Get secure upload URLs
- [Create Document Field](/api-reference/POST%20/api/v1/documents/{id}/fields) - Add fields to documents
- [Update Document Field](/api-reference/PATCH%20/api/v1/documents/{id}/fields/{fieldId}) - Modify existing fields
- [Create Document](/api-reference/POST%20/api/v1/documents) - Create new documents